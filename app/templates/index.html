<!DOCTYPE html>

<html>

<head>
    <title id="title"></title>
    <style>
    body{
        background-image: url();
        background-size: 100% 100%;
        background-repeat : no-repeat;
    }
 /*   div {
        position: absolute; /* абсолютное позиционирование элементов 
        width: 100px; /* ширина элемента 
        height: 100px;  высота элемента 
        }
    .table{
        top: 3em;  смещение от вержнего края 
        right: 50%; смещение от правого края 
    } */
    td.table__col {
        border: 2px solid black;
        ;
    }
    td.in {
        text-align:center;
        font-size: 17px;
        font-family: IrisUPC; /*IrisUPC, OCR-A BT, Europe_Ext*/
        width: 50px;
        
    }

    td.MATH {
        text-align:center;
        font-size: 16px;
        font-family: Europe_Ext;
        width: 180px;
    }

    th.NO_gif {
        background-image: url(http://screenshot.ru/upload/images/2017/10/23/output_tktcDU2a8bd.gif);
        /*https://i.gifer.com/747o.gif, https://www.hibrido.com.br/wp-content/uploads/2018/03/artigo2.gif,
        https://cdn.dribbble.com/users/61699/screenshots/3517380/loader_test.gif,
        https://www.mrplan.es/experiencias/images/loading_23.gif*/
        background-size: 100% 100%;
        background-repeat : no-repeat;
        width: 120px;
        
    }

    th.YES_gif {
        background-image: url(https://cdn.dribbble.com/users/251321/screenshots/2807146/plus.gif);
        /*https://thumbs.gfycat.com/EasygoingWastefulIridescentshark-size_restricted.gif, https://cdn.dribbble.com/users/328354/screenshots/1807697/check-animation.gif,
        https://cdn.dribbble.com/users/251321/screenshots/2807146/plus.gif*/
        background-size: 100% 100%;
        background-repeat : no-repeat;
        width: 50px;
        
    }

    </style>
</head>

<body>

<details><div id="timer"></div>
    <summary>Options</summary>
    <form name="search">
      URL: <input type="text" class="mytext" size="78" value="https://line-02.ccf4ab51771cacd46d.com/line/eventView?lang=ru&eventId="></input>
      <input type="button" id="connect" value="Connect"></input>

      <input type="text" class="videotext" size="64"></input>
      <input type="button" id="watch_video" value="Watch video"></input>
      <p>head link for youtube: <em>https://www.youtube.com/embed/</em></p>
      <p>head link for fonbet: <em>https://line-02.ccf4ab51771cacd46d.com/line/eventView?lang=ru&eventId=</em></p>
    </form>
</details>
<hr>
<div class="video" style="float:right;width:900px;">
  <div class="video-box" id="Video"></div>
</div>
<div class='table'>
    <table border="1">
        <tr>
            <td class='in'><p>Фолы</p><input type = "text" value=0 name="fouls" size=1 style="text-align: center"><p id="fouls_time"></p></td>
            <td class="MATH" id="fouls_math"><p id="fouls_sub"></p></td>
            <th class='NO_gif' id='fouls_gif'></th>
            <td><canvas id = "Canvas_fouls"></td>
        </tr>
        <tr>
            <td class='in'><p>Удары в створ</p><input type = "text" value=0 name="SOT" size=1 style="text-align: center"><p id="SOT_time"></p></td>
            <td class="MATH" id="SOT_math"><p id="SOT_sub"></p></td>
            <th class='NO_gif' id='SOT_gif'></th>
            <td><canvas id = "Canvas_SOT"></td>
        </tr>
        <tr>
            <td class='in'><p>Ауты</p><input type = "text" value=0 name="auts" size=1 style="text-align: center"><p id="auts_time"></p></td>
            <td class="MATH" id="auts_math"><p id="auts_sub"></p></td>
            <th class='NO_gif' id='auts_gif'></th>
            <td><canvas id = "Canvas_auts"></td>
        </tr>
        <tr>
            <td class='in'><p>Удары от ворот</p><input type = "text" value=0 name="SAT" size=1 style="text-align: center"><p id="SAT_time"></p></td>
            <td class="MATH" id="SAT_math"><p id="SAT_sub"></p></td>
            <th class='NO_gif' id='SAT_gif'></th>
            <td><canvas id = "Canvas_SAT"></td>
        </tr>
        <tr>
            <td class='in'><p>Угловые</p><input type = "text" value=0 name="corner" size=1 style="text-align: center"><p id="corner_time"></p></td>
            <td class="MATH" id="corner_math"><p id="corner_sub"></td>
            <th class='NO_gif' id='corner_gif'></th>
            <td><canvas id = "Canvas_corner"></td>
        </tr>
        <tr>
            <td class='in'><p>ЖК</p><input type = "text" value=0 name="ycard" size=1 style="text-align: center"><p id="ycard_time"></p></td>
            <td class="MATH" id="ycard_math"><p id="ycard_sub"></p></td>
            <th class='NO_gif' id='ycard_gif'></th>
            <td><canvas id = "Canvas_ycard"></td>
        </tr>
        <tr>
            <td class='in'><p>Офсайды</p><input type = "text" value=0 name="ofsaid" size=1 style="text-align: center"><p id="ofsaid_time"></p></td>
            <td class="MATH" id="ofsaid_math"><p id="ofsaid_sub"></p></td>
            <th class='NO_gif' id='ofsaid_gif'></th>
            <td><canvas id = "Canvas_ofsaid"></td>
        </tr>
    </table>
</div>
<hr>
<details><div id="stats"></div></details>

<!-- <script type="text/javascript" scr="jquery-3.4.1.min.js"></script> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script>

String.prototype.format = String.prototype.f = function() {
        var s = this,
            i = arguments.length;

        while (i--) {
            s = s.replace(new RegExp('\\{' + i + '\\}', 'gm'), arguments[i]);
        }
        return s;
    };


var watchButton = document.getElementById("watch_video");
watchButton.onclick = myWatch;

function myWatch() {
    var videoWatch = $(".videotext").val();
    console.log(videoWatch);
  $('#Video').html('<iframe frameborder="1" src="{0}" width="900" height="505" frameborder="0" allow="autoplay; fullscreen" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'.f(videoWatch));
      // 
}

function loopConnect(){
  var myVar = setInterval(connect, 1000);
}

function connect(){
    var text = $(".mytext").val();
    if(text.length == 78 ){
        $.ajax({
            url: "/parsing",
            type: "get",
            data: {jsdata: text},
            dataType: "json",
            success: function(response) {
              var dict = JSON.parse(response.stats);
              var graf = JSON.parse(response["stats_graf"]);
              $("#stats").html(response.stats);
              console.log(response['stats_graf']);
              $("#title").text('{0}   {1}'.f(dict["timer"], dict["game"]));

            <!--Спарсеные параметры-->
                
                var timer_sec = parseInt(dict["timer"].split(':')[1]);
                var timer_min = parseInt(dict["timer"].split(':')[0]);
                // console.log(parseFloat(timer_min/100), parseFloat(timer_sec/1000))

                $('meter[id="meter_math"]').val(timer_sec);
                // $("#name_match").text(dict["match"]);
                // $('div[id="__tag__"]').html(dict["_tag_"]);

            <!--Переменные для времени-->
                
                var for_input = [
                ['input[name="fouls"]', "#fouls_time", dict["фолы"], "#fouls_math", "#fouls_sub", "fouls_gif", "фолы"],
                ['input[name="SOT"]', "#SOT_time", dict["удары в створ"], "#SOT_math", "#SOT_sub", "SOT_gif", "удары в створ"],
                ['input[name="auts"]', "#auts_time", dict["вброс аутов"], "#auts_math", "#auts_sub", "auts_gif", "вброс аутов"],
                ['input[name="SAT"]', "#SAT_time", dict["удары от ворот"], "#SAT_math", "#SAT_sub", "SAT_gif", "удары от ворот"],
                ['input[name="corner"]', "#corner_time", dict["угловые"], "#corner_math", "#corner_sub", "corner_gif", "угловые"],
                ['input[name="ycard"]', "#ycard_time", dict["жёлтые карты"], "#ycard_math", "#ycard_sub", "ycard_gif", "жёлтые карты"],
                ['input[name="ofsaid"]', "#ofsaid_time", dict["офсайды"], "#ofsaid_math", "#ofsaid_sub", "ofsaid_gif", "офсайды"]
                                ]
                String.prototype.format = String.prototype.f = function() {
                        var s = this,
                            i = arguments.length;

                        while (i--) {
                            s = s.replace(new RegExp('\\{' + i + '\\}', 'gm'), arguments[i]);
                        }
                        return s;
                    };
                for (var _ in for_input)
                {

                    var min = parseInt(45/$(for_input[_][0]).val());
                    var sec = parseInt((45/$(for_input[_][0]).val())%1*60);
                    $(for_input[_][1]).text(min + ':' + sec);
                    var math_min = timer_min + parseInt(min*parseInt(for_input[_][2])) + parseInt((sec*parseInt(for_input[_][2])+timer_sec)/60);
                    var math_sec = parseInt(sec*parseInt(for_input[_][2])+timer_sec)%60;
                    
                    $(for_input[_][3]).html("<p><strong>{0}:{1} | {2}</strong><sup> ({5}:{6}) </sup></p><hr><p><strong>{3}</strong><sup> ({4}) </sup></p>".f(math_min, math_sec, for_input[_][2], dict[for_input[_][6]+" Total"], dict[for_input[_][6]+" БМ"], dict[for_input[_][6]+" K1"], dict[for_input[_][6]+" K2"]));
                    $(for_input[_][4]).text(for_input[_][2]);

                    
                    if (isNaN(math_min) == false)
                    {
                        if (dict['TIME'] == 1)
                        {   
                            if (math_min > 47)
                            {
                                document.getElementById(for_input[_][5]).className = 'YES_gif';
                            }else document.getElementById(for_input[_][5]).className = 'NO_gif';
                        }
                        
                        if (dict['TIME'] == 0)
                        {
                            if (math_min > 92)
                            {
                                document.getElementById(for_input[_][5]).className = 'YES_gif';
                            }else document.getElementById(for_input[_][5]).className = 'NO_gif';
                        }
                    }
                }


                        var _width = 950;
                        var _height = 100;
                        var _step = 10;
                        var _list = [
                                        [document.getElementById("Canvas_fouls"),
                                        document.getElementById("Canvas_fouls").getContext('2d'),
                                        "фолы - "],

                                        [document.getElementById("Canvas_SOT"),
                                        document.getElementById("Canvas_SOT").getContext('2d'),
                                        "удары в створ - "],

                                        [document.getElementById("Canvas_auts"),
                                        document.getElementById("Canvas_auts").getContext('2d'),
                                        "вброс аутов - "],

                                        [document.getElementById("Canvas_SAT"),
                                        document.getElementById("Canvas_SAT").getContext('2d'),
                                        "удары от ворот - "],

                                        [document.getElementById("Canvas_corner"),
                                        document.getElementById("Canvas_corner").getContext('2d'),
                                        "угловые - "],

                                        [document.getElementById("Canvas_ycard"),
                                        document.getElementById("Canvas_ycard").getContext('2d'),
                                        "жёлтые карты - "],

                                        [document.getElementById("Canvas_ofsaid"),
                                        document.getElementById("Canvas_ofsaid").getContext('2d'),
                                        "офсайды - "]
                                    ]

                        var colors = ["aqua", "black", "blue", "fuchsia", "green", "cyan", "lime", "maroon",
                                    "navy", "olive", "purple", "red", "silver", "teal", "yellow", "azure",
                                    "gold", "bisque", "pink", "orange"];
                        // var numColors = colors.length;
                        // var colorIndex = Math.random() * (numColors - 1);
                        //     colorIndex = Math.round(colorIndex);
                        // var color = colors[colorIndex];

                        for (var i in _list)
                        {   

                            _list[i][0].width = _width;
                            _list[i][0].height = _height;

                            _list[i][1].fillStyle = "black";
                            _list[i][1].lineWidth = 2;
                            _list[i][1].beginPath();
                            _list[i][1].moveTo(10, parseInt(_height/2)); // Начало линии
                            _list[i][1].lineTo(910, parseInt(_height/2)); // Конец линии 
                            _list[i][1].stroke();
                            _list[i][1].font = "7pt lucida console";
                            for (var j = 0; j < 91; )
                                {  
                                    _list[i][1].textAlign = "center";
                                    _list[i][1].fillText(parseInt(j), _step*parseInt(j) + 10, parseInt(_height/2) + 20);
                                    j += 5;
                                    if (j > 90) break
                                    _list[i][1].beginPath();
                                    _list[i][1].moveTo(_step*parseInt(j) + 10, parseInt(_height/2)-8);
                                    _list[i][1].lineTo(_step*parseInt(j) + 10, parseInt(_height/2)+8); 
                                    _list[i][1].stroke();
                                }

                            for (var k = 0; k < 91; k++)
                                {  
                                    if (k%5 == 0) continue
                                    _list[i][1].strokeStyle = 'black';
                                    _list[i][1].lineWidth = 1;
                                    _list[i][1].beginPath();
                                    _list[i][1].moveTo(_step*parseInt(k) + 10, parseInt(_height/2)-5);
                                    _list[i][1].lineTo(_step*parseInt(k) + 10, parseInt(_height/2)+5); 
                                    _list[i][1].stroke();
                                }
                            for (var num = 0; num < 91; num++)
                            {
                                try
                                {
                                    N = graf[_list[i][2]+num+' минута'][3];
                                    _list[i][1].font = "7pt segoe print";
                                    _list[i][1].fillStyle = "black";
                                    _list[i][1].textAlign = "center";
                                    _list[i][1].fillText(N, _step*parseInt(num)+5, parseInt(_height/2)-23-parseInt(N)*5);
                                    // diagram
                                    _list[i][1].strokeStyle = 'aqua';
                                    _list[i][1].lineWidth = 3;
                                    _list[i][1].beginPath();
                                    _list[i][1].moveTo(_step*parseInt(num) + 5, parseInt(_height/2));
                                    _list[i][1].lineTo(_step*parseInt(num) + 5, parseInt(_height/2)-20-parseInt(N)*5);
                                    _list[i][1].stroke();

                                    sub_N = graf[_list[i][2]+(num-1)+' минута'][3];
                                    // line for diagram
                                    _list[i][1].strokeStyle = 'blue';
                                    _list[i][1].lineWidth = 1;
                                    _list[i][1].beginPath();
                                    _list[i][1].moveTo(_step*parseInt(num-1) + 5, parseInt(_height/2)-20-parseInt(sub_N)*5);
                                    _list[i][1].lineTo(_step*parseInt(num) + 5, parseInt(_height/2)-20-parseInt(N)*5); 
                                    _list[i][1].stroke();
                                }
                                catch (e)
                                {
                                    continue
                                }
                            }
                        }

            }
          });
  }
};

var connectButton = document.getElementById("connect");
connectButton.onclick = loopConnect;


</script>

</body>

</html>
